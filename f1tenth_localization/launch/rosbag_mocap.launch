<!-- State estimation based on noisy MoCap data. Used for testing ekf_localization_node  -->

<launch>    
    <!-- load parameters for ekf node -->
    <rosparam command="load" file="$(find f1tenth_localization)/params/rosbag_mocap.yaml"/>
    
    <!--  make sure all nodes subscribe to /clock (required for simulated data) -->
    <param name="/use_sim_time" value="true"/>
    
	<!-- set the name of the mocap source (for the mocap_to_x nodes) -->
	<param name="mocap_name" value="F1Tenth"/>
	
	<!-- publish gathered MoCap data -->
	<node pkg="rosbag" type="play" name="qualisys" args="--clock $(find f1tenth_localization)/bag/mocap_bag1.bag"/>

	<!-- simulate noisy measurements -->
	<node pkg="f1tenth_localization" type="mocap_to_imu.py" name="imu"/>
	<node pkg="f1tenth_localization" type="mocap_to_odom.py" name="odom"/>
	<node pkg="f1tenth_localization" type="odometry_noise.py" name="noise"/>

    <!-- start rviz with config file --> 
    <node pkg="rviz" type="rviz" name="rviz" args="-d /home/linus/.rviz/qualisys.rviz"/>
    
    <!-- define transforms betweem the standard frames --> 
    <node pkg="tf" type="static_transform_publisher" name="map_frame" args="0 0 0 0 0 0 qualisys map 100" />
    <node pkg="tf" type="static_transform_publisher" name="world_frame" args="0 0 0 0 0 0 qualisys odom 100" />
    <node pkg="tf" type="static_transform_publisher" name="Imu_frame" args="0 0 0 0 0 0 odom base_imu_link 100" />
	
    <!-- start and configure the ekf_localization node --> 
    <node pkg="robot_localization" type="ekf_localization_node" name="mocap_ekf"/>

</launch>
